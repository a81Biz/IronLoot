# 1. Arquitectura del Frontend

## 1.1 VisiÃ³n General

El frontend de Iron Loot es una **Single Page Application (SPA)** construida con React y TypeScript. Se comunica con el backend a travÃ©s de un **API Client tipado** que actÃºa como capa de abstracciÃ³n.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         BROWSER                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Pages     â”‚  â”‚  Components â”‚  â”‚     Stores (Zustand)    â”‚ â”‚
â”‚  â”‚  (Routes)   â”‚â”€â”€â”‚   (UI)      â”‚â”€â”€â”‚  - auth.store           â”‚ â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚  - auctions.store       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  - wallet.store         â”‚ â”‚
â”‚         â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                                      â”‚               â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                        â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    API CLIENT                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ auth.api  â”‚  â”‚auctions.apiâ”‚ â”‚   wallet.api      â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”‚
â”‚  â”‚                       â–¼                                 â”‚   â”‚
â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚   â”‚
â”‚  â”‚              â”‚   client.ts     â”‚                       â”‚   â”‚
â”‚  â”‚              â”‚  (Base Client)  â”‚                       â”‚   â”‚
â”‚  â”‚              â”‚  - Auth tokens  â”‚                       â”‚   â”‚
â”‚  â”‚              â”‚  - Auto refresh â”‚                       â”‚   â”‚
â”‚  â”‚              â”‚  - Error handle â”‚                       â”‚   â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â–¼                                      â”‚
â”‚                    HTTP / HTTPS                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      NGINX (ProducciÃ³n)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Static Files  â”‚  â”‚  /api/* â†’ proxy â†’ api:3000             â”‚ â”‚
â”‚  â”‚  (React App)   â”‚  â”‚                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     API (NestJS) :3000                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1.2 Estructura de Carpetas

```
web/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/                    # ğŸ”Œ Cliente API
â”‚   â”‚   â”œâ”€â”€ client.ts           # Cliente base (tokens, refresh, errors)
â”‚   â”‚   â”œâ”€â”€ auth.api.ts         # MÃ³dulo autenticaciÃ³n
â”‚   â”‚   â”œâ”€â”€ auctions.api.ts     # MÃ³dulo subastas
â”‚   â”‚   â”œâ”€â”€ wallet.api.ts       # MÃ³dulo wallet
â”‚   â”‚   â””â”€â”€ index.ts            # Export unificado
â”‚   â”‚
â”‚   â”œâ”€â”€ components/             # ğŸ§± Componentes React
â”‚   â”‚   â”œâ”€â”€ ui/                 # Componentes base (Button, Input, Card)
â”‚   â”‚   â”œâ”€â”€ layout/             # Layouts (MainLayout, AuthLayout)
â”‚   â”‚   â”œâ”€â”€ auction/            # Componentes de subasta
â”‚   â”‚   â””â”€â”€ auth/               # Componentes de auth
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/                  # ğŸ“„ PÃ¡ginas/Rutas
â”‚   â”‚   â”œâ”€â”€ auth/               # Login, Register, Recovery
â”‚   â”‚   â”œâ”€â”€ HomePage.tsx
â”‚   â”‚   â”œâ”€â”€ DashboardPage.tsx
â”‚   â”‚   â”œâ”€â”€ AuctionsPage.tsx
â”‚   â”‚   â”œâ”€â”€ WalletPage.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                  # ğŸª Custom Hooks
â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”œâ”€â”€ useAuction.ts
â”‚   â”‚   â””â”€â”€ useWallet.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ stores/                 # ğŸ“¦ Estado Global (Zustand)
â”‚   â”‚   â”œâ”€â”€ auth.store.ts
â”‚   â”‚   â”œâ”€â”€ auctions.store.ts
â”‚   â”‚   â””â”€â”€ wallet.store.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                  # ğŸ“ Tipos TypeScript
â”‚   â”‚   â””â”€â”€ api.types.ts
â”‚   â”‚
â”‚   â””â”€â”€ styles/                 # ğŸ¨ Estilos Globales
â”‚       â””â”€â”€ globals.css
â”‚
â”œâ”€â”€ public/                     # Archivos estÃ¡ticos
â”œâ”€â”€ Dockerfile                  # Build de producciÃ³n
â”œâ”€â”€ Dockerfile.dev              # Build de desarrollo
â”œâ”€â”€ nginx.conf                  # ConfiguraciÃ³n nginx
â””â”€â”€ vite.config.ts              # ConfiguraciÃ³n Vite
```

---

## 1.3 Patrones de DiseÃ±o

### 1.3.1 API Client (PatrÃ³n de AbstracciÃ³n)

El API Client sigue el patrÃ³n **Repository/Service**, proporcionando una interfaz tipada para todas las operaciones del backend:

```typescript
// Uso simple
import { api } from '@/api';

// AutenticaciÃ³n
const { user, tokens } = await api.auth.login({ email, password });

// Subastas
const auctions = await api.auctions.list({ status: 'ACTIVE' });

// Wallet
const balance = await api.wallet.getBalance();
```

### 1.3.2 Estado Global (Zustand)

Se usa Zustand por su simplicidad y rendimiento:

```typescript
// stores/auth.store.ts
export const useAuthStore = create<AuthState>()(
  persist(
    (set) => ({
      user: null,
      isAuthenticated: false,
      login: async (data) => { /* ... */ },
      logout: async () => { /* ... */ },
    }),
    { name: 'ironloot-auth' }
  )
);

// Uso en componentes
const { user, login, logout } = useAuthStore();
```

### 1.3.3 Lazy Loading

Las pÃ¡ginas se cargan dinÃ¡micamente para mejor rendimiento:

```typescript
const HomePage = lazy(() => import('@/pages/HomePage'));
const DashboardPage = lazy(() => import('@/pages/DashboardPage'));
```

---

## 1.4 Flujo de AutenticaciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Login    â”‚â”€â”€â”€â–¶â”‚ auth.login  â”‚â”€â”€â”€â–¶â”‚  Backend   â”‚
â”‚   Page     â”‚    â”‚   (API)     â”‚    â”‚  /auth/    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                         â”‚                  â”‚
                         â”‚   { tokens }     â”‚
                         â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  setTokens()        â”‚
              â”‚  - localStorage     â”‚
              â”‚  - memory           â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  authStore.user     â”‚
              â”‚  = response.user    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Redirect to        â”‚
              â”‚  /dashboard         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Auto-Refresh de Tokens

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Request    â”‚â”€â”€â”€â–¶â”‚  Backend    â”‚
â”‚  (expired)  â”‚    â”‚   401       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  client.ts detecta  â”‚
              â”‚  401 Unauthorized   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  POST /auth/refresh â”‚
              â”‚  { refreshToken }   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Nuevo accessToken  â”‚
              â”‚  setTokens()        â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Reintentar request â”‚
              â”‚  original           â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1.5 ComunicaciÃ³n en Docker

### Desarrollo (docker-compose)

```
Browser â†’ :5173 â†’ Vite Dev Server
                       â”‚
                       â”‚ (Proxy /api/*)
                       â–¼
                  API :3000
```

### ProducciÃ³n

```
Browser â†’ :80 â†’ Nginx
                  â”‚
                  â”œâ”€â”€ /* â†’ Static files (React)
                  â”‚
                  â””â”€â”€ /api/* â†’ Proxy â†’ API :3000
```

---

## 1.6 RelaciÃ³n con la API

| Endpoint API | MÃ³dulo Frontend | Store |
|--------------|-----------------|-------|
| `/auth/*` | `auth.api.ts` | `auth.store.ts` |
| `/auctions/*` | `auctions.api.ts` | `auctions.store.ts` |
| `/wallet/*` | `wallet.api.ts` | `wallet.store.ts` |
| `/orders/*` | `orders.api.ts` (TODO) | `orders.store.ts` |
| `/notifications/*` | `notifications.api.ts` (TODO) | `notifications.store.ts` |

---

## 1.7 Variables de Entorno

| Variable | DescripciÃ³n | Default |
|----------|-------------|---------|
| `VITE_API_URL` | URL base de la API | `http://localhost:3000` |

En producciÃ³n, nginx maneja el proxy, por lo que el frontend usa rutas relativas (`/api/*`).
